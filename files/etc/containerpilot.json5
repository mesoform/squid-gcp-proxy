{
  consul: 'localhost:8500',
  logging: {
    level: '{{ .LOG_LEVEL }}',
    format: '{{ .LOG_FORMAT }}'  },
  jobs: [
    {
      name: "platform_integration_setup",
      exec: "/usr/local/bin/setdomain.sh"
    },
    {
      name: 'squid-gcp-proxy',
      exec: [
        "/usr/sbin/squid3 -f /etc/squid-gcp-proxy/squid.conf"
      ],
      port: "3128",
      health: {
        exec: 'curl http://localhost:3128',
        interval: "5",
        ttl: "5",
        timeout: "1",
      },
      tags: [
        "squid",
        "gcp",
        "proxy"
      ],
      when: {
        source: "consul_agent",
        once: "healthy"
      }
    },
    {
      name: "consul_agent",
      restarts: "unlimited",
      exec: [
        "/usr/local/bin/consul", "agent",
        "-config-dir=/config",
        "-data-dir=/tmp",
        "-rejoin",
        "-retry-join", "consul",
        "-retry-max", "10",
        "-retry-interval", "10s"
      ],
/*      health: {
        exec: "consul join consul",
        interval: 5,
        ttl: 10
      },
*/
      when: {
        source: "platform_integration_setup",
        once: "exitSuccess"
      }
    }
  ]
}
